<!-- add_contact.html -->
{% extends 'base.html' %}
{% load static %}
{% block title %} Todo List {{ block.super }}{% endblock %}
{% block content %}
{% load custom_tags %}
{% include 'components/alert.html' %}
<div class="container-fluid py-4">
    <div class="row mt-4">
      <div class="col-lg-8 col-8 mb-3">
          <!-- Add your content here -->
      </div>
      <div class="col-lg-4 col-4 mb-3 text-right">
        {% if request.user|has_add_permission:"todo" %}
          <a href="{% url 'todo_add' %}" class="btn bg-gradient-primary btn-sm mb-0"  style="float: right;">+&nbsp; Add ToDo</a>
        {% endif %}
        <div class="ms-md-auto pe-md-3 d-flex align-items-center">
          <form id="searchForm" method="get" class="input-group">
            <span class="input-group-text text-body"></span>
            <input type="text" class="form-control" name="search" id="searchField" placeholder="Search..." value="{{ request.GET.search }}">
          </form>
        </div>
      </div>
        <div class="col-lg-12 col-12">
          <div class="card">
            {% if todo_list %}
            <div class="card-header pb-0">
              <div class="d-lg-flex justify-content-between">
                <div>
                  <h4 class="font-weight-bolder">ToDo List</h4>
                </div>
                <!--status list filter-->
                <div class="d-flex flex-wrap">
                  <div class="dropdown d-inline me-2">
                    <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle " data-bs-toggle="dropdown" id="navbarDropdownMenuLink2" >
                      Status
                    </a>
                    <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="navbarDropdownMenuLink2" data-popper-placement="left-start">
          
                     {% for status in status_values %}
                      <li>
                        <a class="dropdown-item border-radius-md" href="#" onclick="applyFilter('status', '{{ status }}')">{{ status }}</a>
                      </li>
                  {% endfor %}
                  <li><hr class="horizontal dark my-2"></li>
                                  <li><a class="dropdown-item border-radius-md text-danger" href="#" onclick="clearFilter('status')">Remove Filter</a></li>
              
                    </ul>
                  </div>
                <!-- priority list filter-->
                  <div class="dropdown d-inline me-2">
                    <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle " data-bs-toggle="dropdown" id="navbarDropdownMenuLink2">
                      Priority
                    </a>
                    <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="navbarDropdownMenuLink2" data-popper-placement="left-start">
          
                     {% for priority in priority_list %}
                      <li>
                        <a class="dropdown-item border-radius-md" href="#" onclick="applyFilter('priority', '{{ priority }}')">{{ priority }}</a>
                      </li>
                  {% endfor %}
                  <li><hr class="horizontal dark my-2"></li>
                                  <li><a class="dropdown-item border-radius-md text-danger" href="#" onclick="clearFilter('priority')">Remove Filter</a></li>
              
                    </ul>
                  </div>

                   <!-- Module list filter-->
                   <div class="dropdown d-inline me-2">
                    <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle " data-bs-toggle="dropdown" id="navbarDropdownMenuLink2">
                      Module
                    </a>
                    <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="navbarDropdownMenuLink2" data-popper-placement="left-start">
          
                     {% for module in module_list %}
                      <li>
                        <a class="dropdown-item border-radius-md" href="#" onclick="applyFilter('module', '{{ module }}')">{{ module }}</a>
                      </li>
                      
                  {% endfor %}
                  <li><hr class="horizontal dark my-2"></li>
                                  <li><a class="dropdown-item border-radius-md text-danger" href="#" onclick="clearFilter('module')">Remove Filter

                                  </a></li>
              
                    </ul>
                  </div>
                 <!-- Assigned list filter-->
                 <div class="dropdown d-inline me-2">
                  <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle " data-bs-toggle="dropdown" id="navbarDropdownMenuLink2">
                    Assigned To
                  </a>
                  <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="navbarDropdownMenuLink2" data-popper-placement="left-start">
        
                   {% for assigned_user in assigned_to_users %}
                    <li>
                      <a class="dropdown-item border-radius-md" href="#" onclick="applyFilter('assigned_to', '{{ assigned_user }}')">{{ assigned_user }}</a>
                    </li>
                {% endfor %}
                <li><hr class="horizontal dark my-2"></li>
                                <li><a class="dropdown-item border-radius-md text-danger" href="#" onclick="clearFilter('assigned_to')">Remove Filter
                                </a></li>
            
                  </ul>
                </div>
                <!--  Date Range list filter-->
                <div class="dropdown d-inline me-3">
                  <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" id="dateRangeDropdown" aria-expanded="false">
                    Date Range
                  </a>
                  <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="dateRangeDropdown">
                    <li>
                      <form method="get" class="input-group mb-3">
                        <div class="form-row align-items-center">
                          <div class="col-md-12 mb-2">
                            <label for="startDatePicker" class="form-label">Start date</label>
                                <input type="date" class="form-control border-start mx-1" name="start_date" id="startDatePicker" value="{{ date_range.start_date }}">
                            </div>
                           
                        
                        <div class="form-row">
                          <div class="col-md-12 mb-2">
                            <label for="endDatePicker" class="form-label">End date</label>
                                <input type="date" class="form-control border-start mx-1" name="end_date" id="endDatePicker" value="{{ date_range.end_date }}">
                            </div>
                          </div>
                        <br><br>
                        <a class="btn bg-gradient-primary btn-sm mb-0" href="javascript:;" onclick="applyDateRangeFilter()">Apply</a>
                    </form>
                    </li>
                    <li><hr class="horizontal dark my-2"></li>
                    <li><a class="dropdown-item border-radius-md text-danger" href="#" onclick="clearDateRangeFilter()">Remove Filter</a></li>
                  </ul>
                </div>
                <!--end of filter-->
                <a href="" class="btn bg-gradient-secondary" onclick="clearAllFilters()">
                  Clear Filters
                </a>
                </div>
              </div>
            </div>
                

         
                <!-- <div class="col-md-6 text-right">
                  <div class="d-flex">
                    <div class="d-flex justify-content-end">
                    <div class="filter-container ">
                      <div class="dropdown d-inline ">
                        <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" id="priorityDropdown" aria-expanded="false">
                          Module
                        </a>
                        <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="priorityDropdown" style="">
                            <li><a class="dropdown-item border-radius-md" href="javascript:;">Low</a></li>
                            <li><a class="dropdown-item border-radius-md" href="javascript:;">Medium</a></li>
                            <li><a class="dropdown-item border-radius-md" href="javascript:;">High</a></li>
                            <li>
                                <hr class="horizontal dark my-2">
                            </li>
                            <li><a class="dropdown-item border-radius-md text-danger" href="javascript:;">Remove Filter</a></li>
                        </ul>
                    </div>
                      <div class="dropdown d-inline ml-3">
                          <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" id="statusDropdown" aria-expanded="false">
                              Status
                          </a>
                          <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="statusDropdown" style="">
                              <li><a class="dropdown-item border-radius-md" href="javascript:;">Pending</a></li>
                              <li><a class="dropdown-item border-radius-md" href="javascript:;">In-Progress</a></li>
                              <li><a class="dropdown-item border-radius-md" href="javascript:;">Completed</a></li>
                              <li>
                                  <hr class="horizontal dark my-2">
                              </li>
                              <li><a class="dropdown-item border-radius-md text-danger" href="javascript:;">Remove Filter</a></li>
                          </ul>
                      </div>
                  
                      <div class="dropdown d-inline ml-3">
                          <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" id="priorityDropdown" aria-expanded="false">
                              Priority
                          </a>
                          <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="priorityDropdown" style="">
                              <li><a class="dropdown-item border-radius-md" href="javascript:;">Low</a></li>
                              <li><a class="dropdown-item border-radius-md" href="javascript:;">Medium</a></li>
                              <li><a class="dropdown-item border-radius-md" href="javascript:;">High</a></li>
                              <li>
                                  <hr class="horizontal dark my-2">
                              </li>
                              <li><a class="dropdown-item border-radius-md text-danger" href="javascript:;">Remove Filter</a></li>
                          </ul>
                      </div>
                      <div class="dropdown d-inline ml-3" >
                        <a href="javascript:;" class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" id="priorityDropdown" aria-expanded="false">
                          Assgined To
                        </a>
                        <ul class="dropdown-menu dropdown-menu-lg-start px-2 py-3" aria-labelledby="priorityDropdown" style="">
                            <li><a class="dropdown-item border-radius-md" href="javascript:;">Low</a></li>
                            <li><a class="dropdown-item border-radius-md" href="javascript:;">Medium</a></li>
                            <li><a class="dropdown-item border-radius-md" href="javascript:;">High</a></li>
                            <li>
                                <hr class="horizontal dark my-2">
                            </li>
                            <li><a class="dropdown-item border-radius-md text-danger" href="javascript:;">Remove Filter</a></li>
                        </ul>
                    </div>
                    
                    </div>
                  
                      
                  </div>
                  
                    
                    </div>
                </div> -->

              </div>
            </div>
            <div class="card-body p-3 pt-0 mt-4">
              <ul class="list-group list-group-flush" data-toggle="checklist">
                {% for todo_data in todo_list %}
                  <li class="list-group-item border-0 flex-column align-items-start ps-0 py-0 mb-3">
                    <div class="checklist-item {% if todo_data.status == 'in-progress' %}checklist-item-warning{% elif todo_data.status == 'completed' %}checklist-item-success{% else %}checklist-item-primary{% endif %} ps-2 ms-3">

                        <div class="d-flex align-items-center  mt-3 ps-1 row">
                          <div class="col-lg-4 col-sm-12 col-xs-12">
                            <h6 class="mb-0 text-dark font-weight-bold text-sm">{{ todo_data.title }}</h6>
                              <p class="text-xs mb-1 text-secondary font-weight-bold">{{ todo_data.description|safe|truncatechars:200 }}</p>   
  
                              <span class="text-xs text-secondary">{{ todo_data.start_date|date:"M d, Y" }} - {{ todo_data.end_date|date:"M d, Y" }}</span>
                            </p> 
                            </div>
                            <div class="col-lg-2 col-sm-12 col-xs-12">
                              <p class="text-md mb-1 text-secondary font-weight-bolder">Module</p>
                              <span class="text-md font-weight-bold">{{ todo_data.module.name|title }}</span>
                            </div>
                            <div class="col-lg-2 col-sm-12 col-xs-12">
                                <p class="text-md mb-1 text-secondary font-weight-bolder">Assgined To</p>
                                <span class="text-md font-weight-bold">{{ todo_data.assigned_to}}</span>
                              </div>
                              <div class="col-lg-2 col-sm-12 col-xs-12">
                              <p class="text-md mb-1 text-secondary font-weight-bolder">Status</p>
                              <span class="text-md font-weight-bold {% if todo_data.status == 'in-progress' %}text-warning{% elif todo_data.status == 'completed' %}text-success{% else %}text-primary{% endif %}">
                                {{ todo_data.status|title }}
                              </span>
                            </div>
                            <div class="col-lg-1 col-sm-12 col-xs-12">
                              <p class="text-md mb-1 text-secondary font-weight-bolder">Priority</p>
                              <span class="text-md font-weight-bold {% if todo_data.priority == 'high' %}text-danger{% elif todo_data.priority == 'medium' %}text-warning{% else %}text-primary{% endif %}">
                                {{ todo_data.priority|title }}
                              </span>
                            </div>
                            <div class="col-lg-1 col-sm-12 col-xs-12 text-end">
                              <div class="dropstart ms-auto pe-0">
                                <a href="javascript:;" class="cursor-pointer" id="dropdownTable2" data-bs-toggle="dropdown" aria-expanded="false">
                                  <i class="fa fa-ellipsis-h text-secondary" aria-hidden="true"></i>
                                </a>
                                <ul class="dropdown-menu px-2 py-3 ms-sm-n4 ms-n5" aria-labelledby="dropdownTable2" style="">
                                        {% if request.user == todo_data.user_id %}

                                        {% if request.user|has_update_permission:"todo" %}
                                          <li><a class="dropdown-item border-radius-md" href="{% url 'todo_edit' todo_data.id %}">Edit</a></li>
                                        {% endif %}
                                        {% if request.user|has_delete_permission:"todo" %}
                                        <li><a class="dropdown-item border-radius-md"  href="#" onclick="CustomconfirmDelete({{todo_data.id}}, 'Are you sure you want to delete this todo?',

                                          'The todo has been deleted successfully.','{% url 'todo_delete' todo_data.id  %}')">Delete</a></li>
                                        {% endif %}
                                        {% if request.user|has_view_permission:"todo" %}
                                        <li><a class="dropdown-item border-radius-md" href="{% url 'todo_view' todo_data.id %}">View</a></li>
                                        {% endif %}
                                      {% else %}
                                      {% if request.user|has_view_permission:"todo" %}
                                       <li><a class="dropdown-item border-radius-md" href="{% url 'todo_view' todo_data.id %}">View</a></li>
                                       {% endif %}
                                        {% endif %}
                                      </ul>
                              </div>
                            </div>
                          </div>
                        </div>
                    <hr class="horizontal dark mt-4 mb-0">
                  </li>
                {% endfor %}
               
              </ul>
            </div>
            {% else %}
            <h4 class="font-weight-bolder text-center  p-3 pt-0 mt-4">No records found</h4>
          {% endif %}
          </div>
        </div>
      </div>
</div>



{% endblock %}
{% block extra_js %}
<script src="{% static 'assets/js/plugins/sweetalert.min.js' %}"></script>
<script src="{% static 'assets/js/custom_delete.js' %}"></script>
<script>
 // JavaScript code to handle automatic search
  document.getElementById('searchField').addEventListener('input', function(event) {
    const searchValue = event.target.value;
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.set('search', searchValue);
    window.location.href = currentUrl.toString(); // Redirect to the URL with search query 
  });
// JavaScript code to handle filter for date range
  function applyDateRangeFilter() {
    const startDate = document.getElementById('startDatePicker').value;
    const endDate = document.getElementById('endDatePicker').value;
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.set('start_date', startDate);
    currentUrl.searchParams.set('end_date', endDate);
    window.location.href = currentUrl.toString(); // Redirect to the URL with date range filter
  }
// JavaScript code to clear the date range filter
 function clearDateRangeFilter() {
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.delete('start_date');
    currentUrl.searchParams.delete('end_date');
    window.location.href = currentUrl.toString();
}

// JavaScript code to apply the filter on each field
  function applyFilter(filterName, filterValue) {
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.set(filterName, filterValue);
    window.location.href = currentUrl.toString();

    // Update the button text with the selected status value
    document.getElementById('statusDropdown').textContent = filterValue;
}
// JavaScript code to clear single filter on onclick event
function clearFilter(filterName) {
    const currentUrl = new URL(window.location.href);
    currentUrl.searchParams.delete(filterName);
    window.location.href = currentUrl.toString();
}
// JavaScript code to clear all the filters
function clearAllFilters() {
  const currentUrl = new URL(window.location.href);
  const queryParams = new URLSearchParams(currentUrl.search);
  queryParams.delete('status');
  queryParams.delete('priority');
  queryParams.delete('module');
  queryParams.delete('assigned_to');
  queryParams.delete('start_date');
  queryParams.delete('end_date');
  window.history.replaceState({}, document.title, `${currentUrl.pathname}?${queryParams.toString()}`);
  window.location.reload(); // Reload the page after clearing all filters
}


</script>

{% endblock %}     
  
