{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<link id="pagestyle" href="{% static '/assets/css/slider.css' %}" rel="stylesheet" />
{% endblock %}
{% load rest_framework %}
{% block title %}FRA Defect {{ block.super }}{% endblock %}
{% block content %}
{% load custom_tags %}
{% include 'components/alert.html' %}
<div class="container-fluid my-3 py-3">
    <div class="col-lg-12 mt-4">
         <!-- Card Basic Info -->
        <div class="card" id="basic-info">
            <div class="card-header">
                <h5> {% if defect_instance %} Edit {% else %} Add {% endif %}  Defect</h5>
            </div>
            <div class="card-body pt-0">
                <form role="form"  method="POST" autocomplete="off" enctype="multipart/form-data" onsubmit="showLoader()" >
                    <div class='row'>
                        {% csrf_token %}
                        {% render_form serializer %}
                    </div>
                    
                        {% if serializer.data.document_paths and  defect_instance %}
                            {% for document in serializer.data.document_paths %}
                                <div class="col-lg-12">
                                    <div style="position: relative;">
                                    <a href="{{ document.presigned_url }}" download>
                                        <span class="text-sm me-2">{{ document.filename }}</span>
                                    </a>
                                    <a href="#" class="delete-icon" onclick="CustomconfirmDelete('{{requirement_instance.id}}{{defect_instance.id}}  {{document.id}}',
                                            'Are you sure you want to delete this requirement defect document?','The requirement defect document has been deleted successfully.',
                                            '{% url 'remove_requirement_defect_document' defect_instance.id  document.id %}')" class="delete-link ms-2" data-title="{{ requirement_instance.title}}">
                                            <i class="fas fa-times-circle text-danger">  </i> 
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                    {% endif %}
                    <button class="btn bg-gradient-dark btn-sm float-end mt-2 mb-0 mx-2">Save</button>
                    <a class="btn bg-gradient-secondary btn-sm float-end mt-2 mb-0" href="{% url 'customer_requirement_view' customer_id requirement_instance.id %}">Back</a>
        
                    </form>
                    {% include 'components/loader.html' %}
            </div>
        </div>
        <div class="card mt-2" id="basic-info">
            <div class="card-header pb-0">
                <h5> FRA Actions </h5>
            </div>
            <div class="card-body">
                <div class="row gap-2">
                    <div class="col-md-3">
                        <div class="sticky-md-top product-sticky">
                          <div id="carouselExampleCaptions" class="carousel slide ecomm-prod-slider" data-bs-ride="carousel">
                            <div class="carousel-inner bg-light rounded">
                                {% for item in document_paths %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <div class="zoomable-media">
                                        {% if item.is_image %}
                                        <img src="{{ item.presigned_url }}" class="d-block zoomable-image" alt="Product Image">
                                        <div class="zoom-controls">
                                            <i class="fas fa-plus zoom-in-button m-2"></i>
                                            <i class="fas fa-minus zoom-out-button  mx-2"></i>
                                            <i class="fas  fa-sync-alt reset-button  mx-2"></i>
                                            
                                        </div>
                                        {% endif %}
                                        {% if item.is_video %}
                                        <video controls class="d-block zoomable-video">
                                            <source src="{{ item.presigned_url }}" type="video/mp4">
                                        </video>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <ol class="carousel-indicators position-relative product-carousel-indicators my-sm-3 mx-0">
                                {% for item in document_paths %}
                                {% if item.is_image %}
                                <li data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}" class="w-25 h-auto {% if forloop.first %}active{% endif %}">
                                    <img src="{{ item.presigned_url }}" class="d-block wid-100 rounded  border me-4" alt="Product media">
                                </li>
                                {% endif %}
                                {% if item.is_video %}
                                <li data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}" class="w-25 h-auto {% if forloop.first %}active{% endif %}">
                                  <video  class="d-block wid-100 zoomable-video rounded  border p-2" >
                                    <source src="{{ item.presigned_url }}" type="video/mp4">
                                </video>
                                </li>
                                {% endif %}
                                {% endfor %}
                            </ol>
                        </div>
                        
                        </div>
                      </div>
                    <!-- Requirement and Customer Details -->
                    <div class="col-lg-8">
                        <div class="card-body p-0">
                            <p class="text-sm">
                                <b>{{ requirement_instance.action|safe}}</b></p>
                                <p class="text-sm">
                                {{ requirement_instance.description|safe}}</p>
                            <hr class="horizontal gray-light my-4">
                            <div class="row text-sm">
                                <div class="row mb-2">
                                    <div class="col-3"><strong class="text-dark">Customer:</strong></div>
                                    <div class="col-9">{{ requirement_instance.customer_id.first_name|title }}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-3"><strong class="text-dark">Email:</strong></div>
                                    <div class="col-9">{{ requirement_instance.customer_id.email }}</div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-3"><strong class="text-dark">Site Address:</strong></div>
                                    <div class="col-9">{{ requirement_instance.site_address|title}}</div>
                                </div>
                                {% if requirement_instance.surveyor %}
                                    <div class="row mb-2">
                                        <div class="col-3"><strong class="text-dark">Surveyor:</strong></div>
                                        <div class="col-9">{{requirement_instance.surveyor.first_name|title }} {{requirement_instance.surveyor.last_name|title }}</div>
                                    </div>
                                {% endif %}
                                
                            </div>
                           
                        </div>
                        
                       
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}
{% block extra_js %}
{% endblock %}