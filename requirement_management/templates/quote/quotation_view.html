{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<style>
  .custom-table th,
  .custom-table td {
    border: 1px solid #dee2e6;
    padding: 8px;
  }

  table>tbody>tr>td>a>p {
    margin-bottom: 0 !important;
  }
</style>
{% endblock %}
{% load rest_framework %}
{% block title %}Quotation View {{ block.super }}{% endblock %}
{% block content %}
{% load custom_tags %}
{% load requirement_tag %}
{% include 'components/alert.html' %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12 mx-auto">
      <div class="card">
        <div class="card-header pb-0">
          <div class="row mb-3">
              <div class="col-6">
                <h4 class="mb-0">Quotation</h4>
              </div>
              <div class="col-6 text-end">
                {% include 'components/back_button.html' %}
              </div>
          </div>
        </div>
        <div class="card-body pt-0 text-center">
          <div class="row justify-content-between mb-4">
            <div class="col-md-6 text-start">
              <h6 class="text-sm">
                Infinity Fire Prevention Ltd Infinity House
              </h6>
              <p class="text-sm text-secondary d-block mt-2 mb-0">38 Riverside, Sir Thomas Longley Road<br>
                Medway City Estate, Rochester Kent .ME24D
              </p>
              <p class="text-sm text-secondary d-block mt-2 mb-0">Tel: 03300102203</p>
              <p class="text-sm text-secondary d-block mt-2 mb-0">Fax: 03300102204</p>
              <p class="text-sm text-secondary d-block mt-2 mb-0">Email: <a
                  href="mailto:customer@example.com">enquiries@infinityfireprevention.com</a></p>
            </div>

            <div class="col-lg-4 col-md-7 text-start">
              <div class="row mb-2">
                <div class="col-5 text-sm text-start"><strong>Client:</strong></div>
                <div class="col-7 text-sm">{{ customer_data.first_name|title }} {{ customer_data.last_name|title }}
                </div>
              </div>
              <div class="row mb-2">
                <div class="col-5 text-sm text-start"><strong>Client Address:</strong></div>
                <div class="col-7 text-sm">
                  {{ customer_address.address }}
                  {% if customer_address.town %}
                  {{ customer_address.town }},
                  {% endif %}
                  {% if customer_address.county %}
                  {{ customer_address.county }},
                  {% endif %}
                  {% if customer_address.country %}
                  {{ customer_address.country }},
                  {% endif %}
                  {% if customer_address.post_code %}
                  {{ customer_address.post_code }}
                  {% endif %}
                </div>
              </div>
              <div class="row mb-2">
                <div class="col-5 text-sm text-start"><strong>Job Address:</strong></div>
                <div class="col-7 text-sm">{{ requirement_instance.site_address }}</div>
              </div>
              <div class="row mb-2">
                <div class="col-5 text-sm text-start"><strong>UPRN:</strong></div>
                <div class="col-7 text-sm">{{ requirement_instance.UPRN|default:'-'|title }}</div>
              </div>
              <div class="row mb-2">
                <div class="col-5 text-sm text-start"><strong>Job Number:</strong></div>
                <div class="col-7 text-sm">{{ requirement_instance.RBNO|default:'-'|title }}</div>
              </div>
              <div class="row">
                <div class="col-5 text-sm text-start"><strong>Reference Number:</strong></div>
                <div class="col-7 text-sm">IFP-{{ queryset.id }}</div>
              </div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-12">
              <div class="table-responsive">
                <table class="table text-dark">
                  <thead class="bg-default">
                    <tr class="text-sm">
                      <th scope="col" class="pe-2 text-start">SOR Code </th>
                      <th scope="col" class="pe-2 text-start">Defect Action </th>
                      <th scope="col" class="pe-2 text-start">Defect Rectification </th>
                      <th scope="col" class="text-start pe-2">SOR Description</th>
                      <th scope="col" class="text-start pe-2">Category</th>
                      <th scope="col" class="text-start pe-2">Price(£)</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for defect_key, value in queryset.quotation_json.defectSorValues.items %}
                    {% for inner_key, item in value.items %}
                    <tr class="text-sm">
                      <td class="pe-2 text-start">{{ item.sor_items.reference_number }}</td>
                      <td class="pe-2 text-start">{{defect_key|get_defect_action|safe}}</td>
                      <td class="pe-2 text-start">{{defect_key|get_defect_rectification|safe}}</td>
                      <td class="pe-2 text-start">{{ item.sor_items.description|safe }}</td>
                      <td class="pe-2 text-start">{{ item.sor_items.category_id }}</td>
                      <td class="pe-2 text-start">{{ item.sor_items.price }}</td>
                    </tr>
                    {% endfor %}
                    {% endfor %}

                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="card-footer  mt-2">
          <div class="row">
            <div class="col-lg-12 text-end">
              <h5>Total(£) : {{queryset.total_amount}}</h5>

            </div>
          </div>
        </div>
        </form>
      </div>
    </div>

  </div>
</div>
{% endblock %}